# 408 计算机网络 #

internet:互联网（互连网），通用名词，任意通信协议

Internet:因特网，专用名词，TCP/IP协议族

因特网发展的三个阶段：

| 1969                                                      | 1985                                   | 1993                                     |
| --------------------------------------------------------- | -------------------------------------- | ---------------------------------------- |
| ARPANET向互连网发展                                       | 三级结构因特网                         | 多层次ISP结构的因特网                    |
| 1969年，第一个分组交换网ARPANET                           | 1985年，NSFNET(主干网、地区网和校园网) | 1993年，NSFNET被替代，由各种ISP运营      |
| 70年代中期，研究多种网络的互连                            | 1990年，ARPANET任务完成，正式关闭      | 1994年，WWW技术推动因特网迅速发展        |
| 1983年，TCP/IP协议成为ARPANET的标准协议（因特网诞生时间） | 1991年，因特网初步商业化，开始收费     | 1995年，NSFNET停止运作，因特网彻底商业化 |

ISP：Internet Service Provider, 中国为电信、移动、联通，各用户通过ISP接入因特网。

因特网的标准化工作
因特网的标准化工作是面向公众的，其任何一个建议标准在成为因特网标准之前都以RFC技术文档的形式在因特网上发表。
RFC(Request For Comments)的意思是“请求评论”。任何人都可以从因特网上免费下载RFC文档(http:www.ietf.org/rfc.html)，并随时对某个RFC文档发表意见和建议。

电路交换：

报文交换：

分组交换：

| 电路交换                                                     | 报文交换                                                     | 分组交换                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ | :----------------------------------------------------------- |
| （1）建立连接：分配通信资源 <br/>（2） 通话：一直占用通信资源<br/>（3）释放连接：归还通信资源。 |                                                              | 报文交换是分组交换的前身。<br/>在报文交换中，报文被整个地发送，而不是拆分成若干个分组进行发送。交换节点将报文整体接收完成后才能查找转发表，将整个报文转发到下一个节点。 |
|                                                              | 没有建立连接和释放连接的过程。<br/>分组传输过程中逐段占用通信链路有较高的通信线路利用率。<br/>交换节点可以为每一个分组独立选择转发路由，使得网络有很好的生存性 |                                                              |
| 计算机之间的数据传送是突发式的，当使用电路交换来传送计算机数据时，其线路的传输效率一般都会很低，线路上真正用来传送数据的时间往往不到10%甚至1%。 | 分组首部带来了额外的传输开销。<br/>交换节点存储转发分组会造成一定的时延。<br/>无法确保通信时端到端通信资源全部可用，在通信量较大时可能造成网络拥塞。分组可能会出现失序和丢失等问题。 | 报文交换比分组交换带来的转发时延要长很多需要交换节点具有的缓存空间也大很多 |

三种交换方式的对比
若要连续传送大量的数据，并且数据传送时间远大于建立连接的时间，则使用电路交换可以有较高的传输效率。然而计算机的数据传送往往是突发式的，采用电路交换时通信线路的利用率会很低。<br/>报文交换和分组交换都不需要建立连接(即预先分配通信资源)，在传送计算机的突发数据时可以提高通信线路的利用率。<br/>
将报文构造成若干个更小的分组进行分组交换，比将整个报文进行报文交换的时延要小，并且还可以避免太长的报文长时间占用链路，有利于差错控制，同时具有更好的灵活性。


计算机网络早期的一个最简单定义：互连、自治（每台计算机都有独立的软件和硬件，并且可以单独运行）、计算机集合。

计算机网络的分类

| 交换方式                     | 使用者                                           | 传输介质           | 覆盖范围                                                     | 拓扑结构                     |
| ---------------------------- | ------------------------------------------------ | ------------------ | ------------------------------------------------------------ | ---------------------------- |
| 电路交换、报文交换、分组交换 | 公用网（因特网）、专用网(军队、铁路、电力、银行) | 有线网络、无线网络 | 广域网(WAN)几十到几干干米、城域网(MAN)5到50干米、局域网(LAN)1千米左右、个域网(PAN)10米 | 总线型、星型、环型、网状型。 |



***



***



计算机网络的性能指标：
计算机网络的性能指标被用来从不同方面度量计算机网络的性能。

常用的八个计算机网络性能指标

| 速率                                                         | 带宽                                                         | 吞吐量                                                       | 时延                                                         | 时延带宽积                                                   | 往返时间                                                     | 利用率 | 丢包率                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------ | ------------------------------------------------------------ |
| 数据的传送速率(即每秒传送多少个比特) 可简记为b/s，也称为数据率、比特率 | 用来表示网络的通信线路所能传送数据的能力，即在单位时间内从网络中的某一点到另一点所能通过的最高速率。<br/>数据传送速率=min[主机接口速率，线路带宽，交换机或路由器的接口速率] | 吞吐量是指在单位时间内通过某个网络或接口的实际数据量。吞吐量常被用于对实际网络的测量以便获知到底有多少数据量通过了网络。<br/>吞吐量受网络带宽的限制。 | 时延是指数据从网络的一端传送到另一端所耗费的时间，也称为延迟或迟延。数据可由一个或多个分组、甚至是一个比特构成。 | 时延带宽积是传播时延和带宽的乘积。<br/>链路的时延带宽积也称为以比特为单位的链路长度，这对我们以后理解以太网的最短帧长是非常有帮助的。 | 往返时间(Round-Trip Time，RTT)是指从发送端发送数据分组开始，到发送端收到接收端发来的相应确认分组为止，总共耗费的时间。 |        | 丢包率是指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的比率 |
|                                                              |                                                              |                                                              |                                                              |                                                              |                                                              |        |                                                              |

| 速率的单位      | 换算关系                            | 数据量的单位 | 换算关系                  |
| --------------- | ----------------------------------- | ------------ | ------------------------- |
| 比特/秒(b/s)    | 基本单位                            | 比特(b)      | 基本单位                  |
|                 |                                     | 字节(B)      | 1B = 8bit                 |
| 千比特/秒(kb/s) | kb/s =10<sup>3</sup> b/s            | 干字节(KB)   | KB=2<sup>10</sup>B        |
| 兆比特/秒(Mbs)  | Mb/s = k*kb/s = 10<sup>6</sup> b/s  | 兆字节(MB)   | MB =K*KB=2<sup>20</sup>B  |
| 吉比特/秒(Gb/s) | Gb/s= k*Mb/s = 10<sup>9</sup> b/s   | 吉字节(GB)   | GB=K*MB = 2<sup>30</sup>B |
| 太比特/秒(Tb/s) | Tb/s = k*Gb/s = 10<sup>12</sup> b/s | 太字节(TB)   | TB=K*GB=2<sup>40</sup>B   |

```plaintext
发送时延只涉及数据从发送端推送到网络所需的时间，不包括数据在网络中的传播时延、处理时延或排队时延。
对于高带宽网络，发送时延通常较短，但当数据量较大时，发送时延会显著增加。
发送时延=分组长度(b)/发送速率（b/s）=数据大小/带宽
```

```plaintext
传播时延=信号长度(m)/信号传播速率（m/s）
```

排队时延和处理时延不方便计算

```plaintext
发送速率=min[主机接口速率，线路带宽，交换机或路由器的接口速率]
```

| 链路利用率                                                   | 网络利用率                                           |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| 链路利用率是指某条链路有百分之几的时间是被利用的(即有数据通过)<br/>完全空闲的链路的利用率为零 | 网络利用率是指网络中所有链路的链路利用率的加权平均。 |

根据排队论可知，当某链路的利用率增大时，该链路引起的时延就会迅速增加。

当网络的通信量较少时，产生的时延并不大，但在网络通信量不断增大时，分组在交换节点(路由器或交换机)中的排队时延会随之增大，因此网络引起的时延就会增大。

令D<sub>0</sub>表示网络空闲时的时延，D表示网络当前的时延，那么在理想的假定条件下，可用下式来表示D、D<sub>0</sub>和网络利用率U之间的关系。

```plaintext
D(网络当前时延) = D0(网络空闲时的时延) / (1 - U)
```

分组丢失主要有以下两种情况:

1. 分组在传输过程中出现误码，被传输路径中的节点交换机(例如路由器)或目的主机检测出误码而丢弃。
2. 节点交换机根据丢弃策略主动丢弃分组.

丢包率可以反映网络的拥塞情况:

1. 无拥塞时路径丢包率为0。
2. 轻度拥塞时路径丢包率为1%~4%。
3. 严重拥塞时路径丢包率为5%~15%。


常见的三种计算机网络体系解构：

1. | OSI                                                          | TCP/IP     | 1    |
   | ------------------------------------------------------------ | ---------- | ---- |
   | 应用层                                                       | 应用层     |      |
   | 表示层                                                       | 运输层     |      |
   | 会话层                                                       | 网际层     |      |
   | 运输层                                                       | 网络接口层 |      |
   | 网络层                                                       |            |      |
   | 数据链路层                                                   |            |      |
   | 物理层                                                       |            |      |
   | OSI标准失败的原因<br/>专家没有实际经验完成标准时没有商业驱动力<br/>协议实现过分复杂运行效率很低<br/>标准的制定周期太长产品无法及时进入市场<br/>层次划分不太合理有些功能在多个层次中重复出现 |            |      |



#### 数据链路层

数据链路层最基本的服务是将源计算机网络层来的数据可靠的传输到相邻节点的目标计算机的网络层。其主要作用是加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。

#### 数据链路层功能介绍

- 为网络层提供服务。无确认无连接服务，有确认无连接服务，有确认面向连接服务。


- 链路管理，即连接的建立、维持、释放（用于面向连接的服务）。


- 组帧（把网络层的数据进行封装成帧：打帧头帧尾）

- 流量控制（限制发送方）

- 差错控制（帧错、位错）

#### 透明传输

帧的数据部分含有帧定界部分的比特时，仍然可以将这两部分区别开来的方法。

分为：

- 字符计数法
- 字符（节）填充法
- 零比特填充法
- 违规编码法

#### 字符计数法

帧首部使用一个计数字段（第一个字节，八位）来标明帧内字符数（包括该计数字段）。

#### 字符（节）填充法

数据中出现的与帧定界符相同的字段时，在其前面加上转义字符ESC（数据中出现ESC时，也要在前面加上转义字符ESC），接收方收到数据后，发现前面有ESC就知道这是数据而不是控制字段，同时将ESC去掉还原出原来的数据

#### 零比特填充法

发送端，扫描整个信息字段，只要连续5个1，就立即填入1个0。

接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。发现连续5个1时，就把后面的0删除。

#### 违规编码法（更细的内容在王道书上之前记的湖科大的笔记）

违规编码法不需要采用任何填充技术，便能实现数据传输的透明性，但它只适用于采用冗余编码的特殊编码环境。局域网IEEE802标准就采用这种方法。

#### 差错控制（检错、纠错编码）

由于数据通信系统传输特性的不理想和外部干扰的存在，传输中出现差错是不可避免的。

- 全局性：由于线路本身电气特性所产生的随机噪声(热噪声)，是信道固有的，随机存在的。解决办法:提高信噪比来减少或避免干扰。(对传感器下手)
- 局部性：外界特定的短暂原因所造成的冲击噪声，是产生差错的主要原因。解决办法:通常利用编码技术来解决。

差错控制的目的：确保所有的帧按顺序正确递交到数据链路层用户（网络层实体）。

差错的分类：随机差错（随机的、单个的），突发差错（成片的、连续的）

差错控制的方法

- 检错重发法：接收端在收到的信码中检测出错码时，即设法通知发送端重发。
- 前向纠错法：接收端不仅能在收到的信码中发现有错码，而且能够纠正错码。
- 反馈校验法：接收端将收到的信码原封不动地转发回发送端，并与原发送信码相比较。

#### 误码的相关概念

实际的通信链路都不是理想的，比特在传输过程中可能会产生差错(称为比特差错)

- 比特1可能变成比特0
- 比特0可能变成比特1

在一段时间内，传输错误的比特数量占所传输比特总数的比率称为误码率(Bit Error Rate，BER)提高链路的信噪比，可以降低误码率。但在实际的通信链路上，不可能使误码率下降为零。

使用差错检测技术来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(1).png)

检错码（FCS）

奇校验是在待发送的数据后面添加1个校验位，使得添加该校验位后的整个数据中比特1的个数为奇数。

偶校验是在待发送的数据后面添加1个校验位，使得添加该校验位后的整个数据中比特1的个数为偶数。

在实际使用时，奇偶校验又可分为垂直奇偶校验、水平奇偶校验以及水平垂直奇偶校验。

奇偶效验码特点:只能检查出奇数个比特错误

若偶数个1变成了0，或者偶数个0变成了1，比特1的奇偶性不发生改变。

| 原始码  | 奇校验   | 偶校验   |
| ------- | -------- | -------- |
| 1011000 | 10110000 | 10110001 |
| 1010000 | 10100001 | 10100000 |
| 0011010 | 00110100 | 00110101 |
| 0001000 | 00010000 | 00010001 |
| 0000000 | 00000001 | 00000000 |



![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(2).png)

#### 循环冗余校验

数据链路层广泛使用漏检率极低的循环冗余校验:(Cyclic Redundancy Check，CRC)检错技术

循环冗余校验CRC的基本思想:

1. 收发双方约定好一个生成多项式G(X)。
2. 发送方基于待发送的数据和生成多项式G(X)，计算出差错检测码(冗余码)

3. 将冗余码添加到待发送数据的后面一起传输。

4. 接收方收到数据和冗余码后，通过生成多项式G(X)来计算收到的数据和冗余码是否产生了误码。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(3).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(4).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(5).png)

算法要求生成多项式必须包含最低次项即x的0次项 。

**发送方的处理：**

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(6).png)

生成多项式为G(X)=1乘以X^3+1乘以X^2+0乘以X^1+1乘以X^0

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(7).png)

1为够除即被除数和除数位数相同都为4位。

最后一行的1位余数。

**接收方的处理**

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(8).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(9).png)

写错了，接收方构建被除数时不要将生成多项式的系数添加到后面。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(10).png)

奇偶校验、循环冗余校验等差错检测技术，只能检测出传输过程中出现了差错，但并不能定位错误因此无法纠正错误。

要想纠正传输中的差错，可以使用冗余信息更多的纠错码(例如海明码)进行前向纠错。但纠错码的开销比较大，在计算机网络中较少使用。

在计算机网络中，通常采用我们后续课程中将要介绍的检错重传方式来纠正传输中的差错，或者仅仅丢弃检测到差错的帧，这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务。

循环冗余校验CRC具有很好的检错能力(漏检率极低)，虽然计算比较复杂，但非常易于用硬件实现因此被广泛应用于数据链路层。

#### 流量控制

发送方根据接收方接收能力， 控制发送的速率，这种做法称为流量控制。（TCP提供）

较高的发送速度和较低的接收能力的不匹配，会造成传输出错（丢包），因此流量控制也是数据链路层的一项重要工作。

数据链路层的流量控制：点到点；传输层的流量控制：端到端；

| 对比 | 数据链路层               | 传输层                                                  |
| ---- | ------------------------ | ------------------------------------------------------- |
|      | 接收方接收不下不回复确认 | 接收端会给发送端一个窗口公示，告诉发送方发传输层 送慢点 |

#### 差错检测后怎么做

使用差错检测技术(例如循环冗余校验CRC)，接收方的数据链路层就可检测出帧在传输过程中是否产生了误码(比特差错)。

检测出误码了怎么做呢？

这取决于数据链路层向其上层提供的服务类型。

若为不可靠传输服务:仅仅丢弃有误码的帧，其他什么也不做，
若为可靠传输服务:通过某种机制实现发送方发送什么，接收方最终就能收到什么。（例如：接收方检测到了误码并向发送方发送一个否认帧，发送方收到否认帧后。重新发送）。

一般情况下，有线链路的误码率比较低。为了减小开销，并不要求数据链路层向其上层提供可靠传输服务。即使出现了误码，可靠传输的问题由其上层处理。

无线链路易受干扰误码率比较高，因此要求数据链路层必须向其上层提供可靠传输服务

传输差错:分组重复、分组失序、分组丢失出现在数据链路层的上层。

误码(比特差错)出现在数据链路层及其下层

**误码(比特差错)**
**分组丢失**:当分组到达路由器R2时,由于R2的排队的队列已经满了,现在又来了一个分组,只能将该分组丢弃了.

**分组失序**:主机1发送3个有顺序的分组,这3个分组选择了不同的路径,由于路径长度和路由器的繁忙程度不同,所以先发的分组可能最后到达主机2

**分组重复**:发送的分组到达路由器R5,此时由于R5十分繁忙,导致该分组等待的时间很长,主机1发送超时,所以它重新发送了该分组,该分组选择了一条不繁忙的路径到达了主机2,而在R5的分组也到达了主机2.

可靠传输服务并不局限于数据链路层，其他各层均可选择实现可靠传输。

#### 实现可靠传输的三种协议

停止-等待(Stop-and-Wait，SW)协议、协议回退N帧(Go-back-N，GBN)协议、选择重传(Selective Repeat，SR)协议

这三种可靠传输实现机制的基本原理并不仅限于数据链路层，可以应用到其上各层。

#### 停止-等待(Stop-and-Wait，SW)协议

接收方收不到数据分组，就不会发送相应的ACK（确认分组）或NAK（否认分组）。如果不采取措施，发送方就会一直处于等待接收方ACK或NAK的状态。

为了解决上述问题，发送方可在每发送完一个数据分组时就启动一个超时计时器(Timeout Timer)。

若到了超时计时器所设置的超时重传时间(Retransmission Time-Out，RTO)，但发送方仍未收到接收方的ACK或NAK，就重传之前已发送过的数据分组。

一般可将超时重传时间RTO设置为略大于收发双方的平均往返时间RTT。超过RTO，重传。 

###### 数据分组编号

接收方发送的确认分组丢失，发送方没有收到确认分组，认为发送的数据分组丢失，重新发送数据分组，导致分组重复。

为了避免分组重复这种传输错误，必须给每个分组带上序号，序号有0和1这两个。

接收方接收到了同一数据分组的不同序号时，丢弃该数据分组，并向发送方重新发送一个确认分组。

###### 确认分组编号

ACK丢失（左图） ACK延迟（右图）![image-20241205094407301](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%917%EF%BC%881%EF%BC%89.png?raw=true)

数据帧丢失或检测到帧出错

![image-20241205094334404](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%917%EF%BC%882%EF%BC%89.png?raw=true)



![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(11).png)

 发送DATA0，ACK迟到，发送方超时重传DATA0，此时发送方收到了迟到的ACK，发送方发送下一个数据分组DATA1。接收方收到DATA0，根据序号可知，这是一个重复的数据分组，将它丢弃，并发送一个ACK。发送方收到两个对DATA0的ACK，将第二个ACK误认为是对DATA1的。

若对ACK进行比编号，则可知道这是对0号数据分组的重复确认忽略即可。

注意事项：

- 使用超时重传机制后，就可以不使用否认机制了，这样可使协议实现起来更加简单。但是，如果点对点链路的误码率较高，使用否认机制可以使发送方在超时计时器超时前就尽快重传。
- 为了让接收方能够判断所收到的数据分组是否是重复的，需要给数据分组编号。由于停止-等待协议的特性，只需1个比特编序号即可，即序号0和序号1。
- 为了让发送方能够判断所收到的确认分组是否是重复的，需要给确认分组编号，所用比特数量与数据分组所用比特数量一样。
- 数据链路层一般不会出现确认分组迟到的情况，因此在数据链路层实现停止-等待协议可以不用给确认分组编号。
- 给超时计时器设置的超时重传时间RTO应当仔细选择，一般将RTO设置为略大于收发双方的平均往返时间RTT。
- 在数据链路层，点对点的往返时间RTT比较固定，RTO就比较好设定。
- 在运输层，由于端到端往返时间非常不确定，设置合适的超时重传时间RTO有时并不容易。停止-等待协议属于自动请求重传(Automatic Repeat reQuest，ARQ)协议。即重传的请求是发送方自动进行的，而不是接收方请求发送方重传某个误码的数据分组。

#### 停止-等待协议的信道利用率 

TD是发送方发送数据分组所耗费的发送时延（发送方将一个分组完整推送到链路中所需要的时间）。 TA是接收方发送确认分组所耗费的发送时延。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(12).png)

若出现超时重传，对于传送有用的数据信息来说，信道利用率还要降低。
在往返时间RTT相对较大的情况下，为了提高信道利用率，收发双方不适合采用停止-等待协议，而可以选择使用回退N帧(GBN)协议或选择重传(SR)协议。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(14).png)

答案为D

#### 回退N帧协议(GBN)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(15).png)

采用n个比特给分组编序号，序号范围是0~(2^n-1)。本例假设采用3个比特给分组编序号则序号范围是0~7。(3个比特可以表示2^3个分组，若以0开始则为0~7)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(16).png)

发送方需要维护一个发送窗口WT，在未收到接收方确认分组的情况下，发送方可将序号落入WT内的所有数据分组连续发送出去。
采用n个比特给分组编序号，则WT的取值范围是1<WT≤(2^n-1)。本例假设采用3个比特给分组编序号，则WT的取值范围是2~7，本例取WT=5。（流水线式发送大于1，不能为8，会导致分组重复）

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(17).png)

接收方需要维护一个接收窗口WR只有正确到达接收方(无误码)且序号落入WR内的数据分组才被接收方接收。 WR的取值只能是1，这一点与停止-等待协议是相同的。

接收方每正确收到一个序号落入接收窗口的数据分组，就将接收窗口向前滑动一个位置，这样就有一个新的序号落入接收窗口。与此同时，接收方还要给发送方发送针对该数据分组的确认分组。
发送方每收到一个按序确认的确认分组，就将发送窗口向前滑动一个位置，这样就有一个新的序号落入发送窗口，序号落入发送窗口内的数据分组可继续被发送。

在回退N帧协议的工作过程中，发送方的发送窗口和接收方的接收窗口按上述规则不断向前
滑动。因此，这类协议又称为滑动窗口协议。

##### 无传输错误的情况

在无传输差错的情况下，回退N帧协议的信道利用率比停止-等待协议的信道利用率有显著提高。提高的程度取决于发送窗口的大小。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(18).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(19).png)

##### ![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(20).png)

接收方每正确收到一个序号落入接收窗口的数据分组，就将接收窗口向前滑动一个位置这样就有一个新的序号落入接收窗口。与此同时，接收方还要给发送方发送针对该数据分组的确认分组。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(21).png)

发送方每收到一个按序确认的确认分组，就将发送窗口向前滑动一个位置，这样就有一个新的序号落入发送窗口，序号落入发送窗口内的数据分组可继续被发送。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(22).png)

##### 超时重传、回退N帧的情况

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(23).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(24).png)

通过DATA2中的检错码发现了误码将其丢弃。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(25).png)

将DATA2丢弃后接收窗口不再移动

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(26).png)

3、4的序号未落入窗口（当前接收窗口为2），接收方将其丢弃。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(27).png)

若数据分组未落入接收窗口，接收方丢弃该分组，并发送最近的数据分组的确认分组。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(28).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(29).png)

发送方收到0、1的确认分组，就将发送窗口向前滑动两个位置，这样就有新的序号5和6落入发送窗口。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(30).png)

发送方现在可将5号和6号数据分组发送出去，发送方收到针对1号数据分组的两个重复确认。发送方就知道了2号数据被丢弃，而之后的两个数据分组也被丢弃。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(31).png)

 5、6未落入接收窗口，接收方将其丢弃，并发送1的确认分组。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(32).png)

我们假设发送方收到四个重复确认时仍然不会立刻重传，当2号数据分组发生超时，发送方就将序号落入发送窗口内的超时的2号数据分组和其后已发送的 3~6号数据分组全部重传，尽管发送方之前已发送的3~6号数据分组到达接收方时并未出现误码，但是接收方只能接收序号落入接收窗口内的数据分组。一旦2号数据分组出现误码被接收方丢弃其后连续发送的3~6号数据分组都要被重传，即一旦出错就需要退回去重传已发送过的N个数据分组。

一个数据分组的差错就可能引起大量数据分组的重传。
在信道质量较差(容易出现误码)的情况下，回退N帧协议的信道利用率并不比停止-等待协议的信道利用率高。

回退N帧协议的接收方采用累积确认方式。

接收方不必对收到的每一个数据分组都发送一个确认分组，而是可以在收到几个序号连续的数据分组后，对按序到达的最后一个数据分组发送确认分组。

接收方何时发送累积确认分组，由具体实现决定。

确认分组ACKn表明序号为n及之前的所有数据分组都已正确接收。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(33).png)

发送5个数据分组，返回两个累计确认分组。

若ACK1丢失，发送窗口移动5个。

累积确认的优点
减少向网络中注入确认分组的数量。
即使确认分组丢失，也可能不必重传数据分组。

累积确认的缺点
不能向发送方及时准确地反映出接收方已正确接收的所有数据分组的数量。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(34).png)

发送窗口为一次发送的分组的个数，必然大于2。为什么不能为8呢？当发送窗口为8时，接收方接收，发送累计确认分组ACK7，发送途中丢失。发送方超时重传，接收方收到，但是它分辨不了这是重新发的（分组重复，不可靠传输直接丢弃），还是新发的分组（接收窗口后移），所以发送窗口不能为8。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(35).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(36).png)

累计确认分组，说明3之前包括3的数据被接收，发送窗口下滑动4个位置。重传4、5、6、7。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(37).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%91%20(38).png)

**没看懂，二轮再学。**

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%912%20(6).png)

#### 选择重传协议(SR) 

由于GBN协议的弊端，在累积确认的机制下，如果有错误的话，则发送方将会批量重传，这样使效率降低。

用n(n>1)个比特给分组编号

1 <WR<=WT （WR超过WT没有意义）

WT+ WR≤ 2^n （确保接收窗口向前滑动后，落入接收窗口内的新序号与之前的旧序号没有重鲁，避免无法分辨新旧数据分组。）

推出1 < WR ≤ 2^(n-1)

当WR取最大值2^(n-1)时，WT能取到的最大值也为 2^(n-1)。

为了使发送方仅重传出现差错的数据分组接收方不再采用累积确认，而需要对每一个正确接收的数据分组进行逐一确认。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%912%20(1).png)

0出现误码，接收方将其丢弃并接收1~3号数据分组

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%912%20(2).png)

接收方将1~3号缓存后发送对应的确认分组。因为不完整，接收窗口不能不能向前滑动，且数据只能先缓存，不能提交给上层。

发送方接收到确认分组后，记录1~3号已被接收。

到达ATT后，只有0号数据分组的确认分组没有收到，于是超时重传。

重传的0号到达接收方后，接收窗口先后滑动4个位置并发送0号的确认分组，缓存的数据取走。

发送方接收到0号的确认分组后，发送窗口向后移动4个位置，并将缓存中的数据删除。

#### 故意取Wr=5

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%912%20(3).png)

发送方发送0~4的数据分组，接收方收到并滑动窗口，发送对应的确认分组，但是0的确认分组丢失，发送方收到后，记录1~4被接收，0号超时重传，此时，0号的序号落入了接收窗口内，可以被接收，但是接收方错认为了是新的数据被接受，导致了分组重复。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%912%20(4).png)

与回退N帧协议不同，选择重传协议不采用累积确认，接收方需要对每一个正确接收的数据分组进行逐一确认。
发送方仅重传未收到确认而超时的数据帧，因此重传0号和2号这两个数据帧。

3号帧没有超时，需要先等待，再做后面的处理。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%912%20(5).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/image-20241125230806859.png)

复盘完成

#### 点对点协议PPP

点对点协议(Point-to-Point Protocol，PPP)是目前使用最广泛的点对点数据链路层协议。
点对点协议PPP是因特网工程任务组(Internet Engineering Task Force，IETF)于1992年制定的。经过多次修订，目前PPP已成为因特网的正式标准[RFC1661，RFC1662]。
点对点协议PPP主要有两种应用:

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(1).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(2).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(3).png)

标志(Flag)字段:PPP帧的定界符，取值为0x7E。

地址(Address)字段:取值为0xFF，预留(目前没有什么作用)
控制(Control)字段:取值为0x03，预留(目前没有什么作用)

协议(Protocol)字段:其值用来指明帧的数据载荷应向上交付给哪个协议处理

帧检验序列(Frame Check Sequence，FCS)字段:其值是使用循环冗余校验CRC计算出的检错码。



##### PPP帧的透明传输

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(4).png)

标志(Flag)字段:是PPP帧的定界符，取值为:
从字节角度看:取值为0x7E。（字节填充法）
从比特角度看:取值为01111110。（零比特填充法）

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(5).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(6).png)

##### PPP帧的差错检测

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(7).png)

帧检验序列FCS字段:其值是使用循环冗余校验CRC计算出的检错码。

CRC采用的生成多项式为CRC-CCITT=X16+X12+X5+1

接收方每收到一个PPP帧，就进行CRC检验:若CRC检验正确，就收下这个帧;否则，就丢弃这个帧。使用PPP的数据链路层，向上提供的是不可靠数据传输服务。

##### PPP的工作状态

以用户主机拨号接入因特网服务提供者ISP的拨号服务器的过程为例：

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(8).png)

> 王道117页

PPP链路的开始和结束状态都是静止状态，这时用户pc 与ISP的的拨号服务器之间并不存在物理层的连接。当检测到调制解调器的载波信号，并建立物理层链接后，PPP就进入了链路的建立状态。在建立状态下，链路控制协议LCP，开始协商一些配置选项。若协商成功，就进入鉴别状态，若协商失败，就进入到静止状态。所协商的配置选项包括最大帧长、鉴别协议等。可以不使用鉴别，也可使用口令鉴别协议PAP或挑战握手鉴别协议CHAP。若通信双方无须鉴别或鉴别身份成功，则进入网络状态，若鉴别失败，则进入终止状态。进入网络状态后，PPP链路的两端通过互相交换网络层特定的NCP分组，来进行NCP配置。如果PPP链路的上层使用的是IP协议，则使用IP控制协议IPCP，来对PPP链路的每一端配置IP模块，例如分配IP地址。NCP配置完成后，就进入打开状态，只要链路进入打开状态，双方就可进行数据通信。当出现故障或链路的一端发出终止请求时，就进入终止状态。当载波停止后就回到静止状态。 

#### 共享式以太网

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(9).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%913%20(10).png)

#### 网络适配器

要将计算机连接到以太网，需要使用相应的网络适配器一般简称为“网卡(Adapter)

在计算机内部，网卡与CPU之间的通信，一般是通过计算机主板上的I/0总线以并行传输方式进行。
网卡与外部以太网(局域网)之间的通信，一般是通过传输媒体(同轴电缆、双绞线电缆、光纤)以串行方式进行的。
网卡除要实现物理层和数据链路层功能，其另外一个重要功能就是要进行并行传输和串行传输的转换，由于网络的传输速率和计算机内部总线上的传输速率并不相同，因此在网卡的核心芯片中都会包含用于缓存数据的存储器。
在确保网卡硬件正确的情况下，为了使网卡正常工作，还必须要在计算机的操作系统中为网卡安装相应的设备驱动程序。驱动程序负责驱动网卡发送和接收帧。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(1).png)

#### MAC地址

当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个数据链路层地址。
在每个主机发送的帧的首部中，都携带有发送主机(源主机)和接收主机(目的主机)的数据链路层地址。由于这类地址是用于媒体接入控制(Medium Access Control，MAC)的，因此被称为MAC地址。

MAC地址一般被固化在网卡的电可擦可编程只读存储器EEPROM中，因此MAC地址也被称为硬件地址，MAC地址有时也被称为物理地址（数据链路层范畴）。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(2).png)

一般情况下，普通用户计算机中往往会包含两块网卡:

一块是用于接入有线局域网的以太网卡
另一块是用于接入无线局域网的Wi-Fi网卡

每块网卡都有一个全球唯一的MAC地址，交换机和路由器往往具有更多的网络接口，所以会拥有更多的MAC地址。

综上所述，严格来说，MAC地址是对网络上各接口的唯一标识而不是对网络上各设备的唯一标识。

OUI又称公司标识符。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(3).png)

b0~b7为8个比特。

将每4个比特写成一个十六进制的字符，共12个字符，将每两个字符分为一组，中间用短线连接。（MAC地址的标准表示方法）

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(4).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(5).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(6).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(7).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(8).png)

主机B发送一个帧，目的地址为广播地址（所有主机均可接收）。

网卡从网络上每收到一个无误码的帧，就检查帧首部中的目的MAC地址，按以下情况处理:

(1)如果目的MAC地址是广播地址(FF-FF-FF-FF-FF-FF)，则接受该帧。

(2)如果目的MAC地址与网卡上固化的全球单播MAC地址相同，则接受该帧。

(3)如果目的MAC地址是网卡支持的多播地址，则接受该帧。

(4)除上述(1)、(2)和(3)情况外，丢弃该帧。

网卡还可被设置为一种特殊的工作方式:工作在混杂方式的网卡混杂方式(Promiscuous Mode)只要收到共享媒体上传来的帧就会收下，而不管帧的目的MAC地址是什么。

对于网络维护和管理人员，这种方式可以监视和分析局域网上的流量，以便找出提高网络性能的具体措施。

嗅探器(Sniffer)就是一种工作在混杂方式的网卡，再配合相应的工具软件(Wire Shark)，就可以作为一种非常有用的网络工具来学习和分析网络。

混杂方式就像一把“双刃剑”，黑客常利用这种方式非法获取网络用户的口令。

全球单播MAC地址就如同身份证上的身份证号码，具有唯一性，它往往与用户个人信息绑定在一起。因此，用户应尽量确保自己拥有的全球单播MAC地址不被泄露。

为了避免用户设备连接Wi-Fi热点时MAC地址泄露的安全问题，目前大多数移动设备都已经采用了随机MAC地址技术。

#### CSMA/CD协议的基本原理

在以太网的发展初期，人们普遍认为“无源的电缆线比有源器件可靠”，因此将多个站点连接在一条总线上来构建共享总线以太网。

共享总线以太网具有天然的广播特性，即使总线上某个站点给另一个站点发送单播帧，表示的信号也会沿着总线传播到总线上的其他各站点。

当某个站点在总线上发送帧时，总线资源会被该站点独占。此时，如果总线上的其他站点也要在总线上发送帧，就会产生信号碰撞。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(9).png)

为了解决各站点争用总线的问题，共享总线以太网使用了一种专用协议CSMA/CD，它是载波监听/多址接入/碰撞检测(Carrier Sense Multiple Access Collision Detection)的英文缩写词。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(10).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(11).png)

B发送信号，没有到C，C检测空闲，发送信号，两个信号碰撞。由于碰撞信号里C近，C先检测到，于是停止一段随机时间后，重新载波检测。这是B检测到碰撞信号，于是同理。

发送帧的站点一旦检测到碰撞，除了立即停止发送帧外，还要再继续发送32比特或48比特的人为干扰信号(Jamming Signal)，以便有足够多的碰撞信号使所有站点都能检测出碰撞。

载波监听检测到总线空闲，但总线并不一定空闲，使用CSMA/CD协议的共享总线以太网上的各站点，只是尽量避免碰撞并在出现碰撞时做出退避后重发的处理，但不能完全避免碰撞。

在使用CSMA/CD协议时，由于正在发送帧的站点必须“边发送帧边检测碰撞进行发送和接收，因此站点不可能同时进行全双工通信，而只能进行半双工通信(双向交替通信)。
####  共享式以太网的争用期

使用CSMAVCD协议的共享总线以太网上的任意站点在发送帧的过程中都可能会遭遇碰撞。

某个站点从发送帧开始，最长要经过多长时间，才能检测出自己发送的帧与其他站点发送的帧产生了碰撞?

deta为数据从A到B的传播时延。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(12).png)



站点从发送帧开始，最多经过时长2tao(即deta→0)就可检测出所发送的帧是否遭遇了碰撞。

因此，共享总线以太网的端到端往返时间2tao被称为争用期(Contention Period)或碰撞窗口(ColisionWindow)，它是一个非常重要的参数。

站点从发送帧开始，经过争用期2tao这段时间还没有检测到碰撞，就可以肯定这次发送不会产生碰撞。
从争用期的概念可以看出，共享总线以太网上的每一个站点从发送帧开始，到之后的一小段时间内，都有可能遭遇碰撞，而这一小段时间的长短是不确定的，它取决于另一个发送帧的站点与本站点的距离但不会超过总线的端到端往返传播时延，即一个争用期2tao。
很显然，总线的长度越长(单程端到端传播时延越大)，网络中站点数量越多，发生碰撞的概率就越大。
因此，共享以太网的总线长度不能太长，接入的站点数量也不能太多。

10Mb/s共享总线以太网(传统以太网)规定:争用期2tao的值为512比特的发送时间，即51.2微秒。

争用期2tao=512b/10Mb/s=512b/10*10^6b/s=51.2微秒
单程端到端传播时延tao=25.6微秒
假设信号的传播速率为2 x10^8m/s
则总线长度为2x10^8m/s x25.6us=5120m

除考虑了信号传播时延外，还考虑到网络中可能存在转发器所带来的时延以及产生碰撞时继续发送32比特或48比特人为干扰信号所持续的时间等。

共享总线以太网规定:总线长度不能超过2500m。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(13).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(14).png)

最短为deta=tao，最长为deta=0

#### 共享式以太网的最小帧长和最大帧长

为了确保共享总线以太网上的每一个站点在发送完一个完整的帧之前，能够检测出是否产生了碰撞，帧的发送时延就不能少于共享总线以太网端到端的往返时间，即一个争用期2tao。
对于10Mb/s的共享总线以太网，其争用期2tao的值规定为51.2微秒，因此其最小帧长为512b，即64B（比特）。

10Mb/sx51.2us=512b=64B

最小帧长=数据传输速率*争用期2tao

当某个站点在发送帧时如果帧的前64B没有遭遇碰撞，那么帧的后续部分也就不会遭遇碰撞。也就是说，如果遭遇碰撞，就一定是在帧的前64B之内。
由于发送帧的站点边发送帧边检测碰撞，一旦检测到碰撞就立即中止帧的发送，此时已发送的数据量一定小于64B。因此，接收站点收到长度小于64B的帧，就可判定这是一个遭遇了碰撞而异常中止的无效帧，将其丢弃即可。

一般来说，帧的数据载荷的长度应远大于帧首部和尾部的总长度，这样可以提高帧的传输效率。
然而，如果不限制数据载荷的长度上限，就可能使得帧的长度太长，这会带来一些问题。

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(16).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(17).png)

 传输时延等于往返时长，最小帧长减少，传输速率不变，传输时延减少，距离减少。



#### 共享式以太网的退避算法

在使用CSMA/CD协议的共享总线以太网中，正在发送帧的站点一边发送帧一边检测碰撞，当检测到碰撞时就立即停止发送，退避一段随机时间后再重新发送。

共享总线以太网中的各站点采用截断二进制指数退避算法来选择退避的随机时间。
(Truncated Binary Exponential Backoff)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(18).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(19).png)

如果连续多次发生碰撞，就表明可能有较多的站点参与竞争信道。但使用上述退避算法可使重传需要推迟的平均时间随重传次数而增大(即动态退避)，因而减小产生碰撞的概率。

当重传达16次仍不能成功时就表明同时打算发送帧的站点太多，以至于连续产生碰撞，此时应放弃重传，传并向高层报告 。

#### 共享式以太网的信道利用率 

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(20).png)

考虑以下这种理想情况:

总线一旦空闲就有某个站点立即发送帧

各站点发送帧都不会产生碰撞

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(21).png)

![](https://cdn.jsdelivr.net/gh/xiaoyizhiy/testnotebook/%E8%AE%A1%E7%BD%914%20(22).png)

选项B的描述错误，因为CSMA/CD协议不适用于无线网络。对于802.11无线局域网，可以使用CSMA/CA协议。

选项D的描述正确，因为选项D中给出“信号传播延迟趋近于0”，这相当于信号瞬间到达整个网络，网络中各站点瞬间就知道总线被占用，因此不会出现碰撞，进而使信道利用率趋近100%。

#### 使用集线器的共享式以太网

早期的传统以太网是使用粗同轴电缆的共享总线以太网，后来发展到使用价格相对便宜的细同轴电缆。

当初认为这种连接方法既简单又可靠，因为在那个时代普遍认为有源器件不可靠，而无源的电缆线才是最可靠的。
然而，实践证明这种使用无源电缆线和大量机械接口的总线型以太网并不像人们想象的那么可靠。

在使用细同轴电缆的共享总线以太网之后，以太网发展出来了一种使用大规模集成电路来替代总线、并且可靠性非常高的设备，叫作集线器(Hub)。

站点连接到集线器的传输媒体也转而使用更便宜、更灵活的双绞线电缆。

集线器的一些主要特点如下：

- 使用集线器的以太网虽然物理拓扑是星型的，但在逻辑上仍然是一个总线网。总线上的各站点共享总线资源，使用的还是CSMA/CD协议。
- 集线器只工作在物理层，它的每个接口仅简单地转发比特，并不进行碰撞检测。碰撞检测的任务由各站点中的网卡负责。
- 集线器一般都有少量的容错能力和网络管理功能,例如：若网络中某个站点的网卡出现了故障而不停地发送帧，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网能正常工作。

![image-20241201145518570](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(1).png?raw=true)

发送帧时均发送到整个网络中，发送多个帧时都会出现碰撞。

- IEEE于1990年制定了10BASE-T（10：传输速率为10Mb/s；BASE：采用基带信号进行传输；T:采用双绞线作为传输媒体。）星型以太网的标准802.3i，这种以太网是局域网发展史上的一座非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢固的基础。

- 10BASE-T以太网的通信距离较短，每个站点到集线器的距离不能超过100m。
- IEEE 802.3以太网还可使用光纤作为传输媒体，相应的标准为10BASE-F，“F”表示光纤。光纤主要用作集线器之间的远程连接。

#### 扩展站点与集线器之间的距离

- 共享总线以太网中两站点之间的距离不能太远，否则它们之间所传输的信号就会衰减到使CSMA/CD协议无法正常工作。
- 在早期广泛使用粗同轴电缆或细同轴电缆共享总线以太网时，为了提高网络的地理覆盖范围，常用的是工作在物理层的转发器。
- IEEE 802.3标准规定，两个网段可用一个转发器连接起来，任意两个站点之间最多可以经过三个网段。
- 随着使用双绞线和集线器的10BASE-T星型以太网成为以太网的主流类型，扩展网络覆盖范围就很少使用转发器了。
- 在10BASE-T星型以太网中，可使用光纤和一对光纤调制解调器来扩展站点与集线器之间的距离。这种扩展方法比较简单，所需付出的代价是:为站点和集线器各增加一个用于电信号和光信号转换的光纤调制解调器，以及它们之间的一对通信光纤。
  信号在光纤中的衰减和失真很小，因此使用这种方法可以很简单地将站点与集线器之间的距离扩展到1000m以上。

#### 扩展共享式以太网的覆盖范围和站点数量

以太网集线器一般具有8~32个接口，如果要连接的站点数量超过了单个集线器能够提供的接口数量，就需要使用多个集线器，这样就可以连接成覆盖更大范围、连接更多站点的多级星型以太网。

采用多个集线器连接而成的多级星型以太网，在扩展了网络覆盖范围和站点数量的同时，也带来了一些负面因素。

![image-20241201150851845](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(2).png?raw=true)

![image-20241201150925983](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(3).png?raw=true)

合并成了一个更大的碰撞域，碰撞的可能性更大了。

在物理层扩展的共享式以太网仍然是一个碰撞域，不能连接太多的站点，否则可能会出现大量的碰撞，导致平均吞吐量太低。

#### 使用网桥在数据链路层扩展以太网（网桥是交换机的前身）

![image-20241201151250763](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(4).png?raw=true)

网桥(bridge)工作在数据链路层(包含其下的物理层)，因此网桥具备属于数据链路层范畴的相关能力：

- 网桥可以识别帧的结构。
- 网桥可以根据帧首部中的目的MAC地址和网桥自身的帧转发表来转发或丢弃所收到的帧

#### 网桥的主要结构和基本工作原理

![image-20241201152523079](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(5).png?raw=true)

用网桥链接两个网络

![image-20241201152606199](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(6).png?raw=true)

![image-20241201152618032](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(7).png?raw=true)

A发送给D一个单播帧，到达网桥中，网桥根据自己的转发表查到要从自己的接口2发送，帧到达D

![image-20241201152915803](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(8).png?raw=true)

![image-20241201153020622](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(9).png?raw=true)

A发送给C一个单播帧，网桥查找转发表，得知要从接口1转发，但是帧是从接口1接收的，所以A、C在同一个网段，不需要网桥的转发，于是网桥丢弃该帧。

![image-20241201153325554](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(10).png?raw=true)

A发送一个广播帧。

网桥的接口在向其连接的网段转发帧时会执行相应的媒体接入控制协议，对于共享式以太网就是CSMA/CD协议。

#### 透明网桥的自学习和转发帧的流程

转发表是如何建立的呢？

- 透明网桥(Transparent Bridge)通过自学习算法建立转发表。
- 透明网桥中的“透明”，是指以太网中的各站点并不知道自己所发送的帧将会经过哪些网桥的转发，最终到达目的站点。也就是说，以太网中的各网桥对于各站点而言是看不见的。
- 透明网桥的标准是IEEE 802.1D，它通过一种自学习算法基于以太网中各站点间的相互通信逐步建立起自己的转发表。

A发送给D一个单播帧，从接口1进入网桥，网桥在转发表中登记该帧的源地址A和进入的接口1并且转发，转发时查找D，由于此时转发表中没有D，所以现在盲目转发。

D发送给A一个单播帧，从接口2进入网桥，网桥在转发表中登记该帧的源地址D和进入的接口2并且转发，转发时查找A，转发表中有A，所以现在从接口1转发。

1. 网桥收到帧后进行登记(即自学习)，登记的内容为帧的源MAC地址和进入网桥的接口号。
2. 网桥根据帧的目的MAC地址和网桥的转发表对帧进行转发，包含以下三种情况:
   - 明确转发:网桥知道应当从哪个接口转发帧。
   - 盲目转发:网桥不知道应当从哪个接口转发帧，只能将其通过除进入网桥的接口外的其他所有接口转发。
   - 丢弃:网桥知道不应该转发该帧，将其丢弃（源地址和目的地址在同一网段中，不需要经过网桥）

请同学们注意:
(1)如果网桥收到有误码的帧则直接丢弃
(2)如果网桥收到一个无误码的广播帧，则不用进行查表，而是直接从除接收该广播帧的接口的其他接口转发该广播帧。
(3)转发表中的每条记录都有其有效时间，到期自动删除!这是因为各站点的MAC地址与网桥接口的对应关系并不是永久性的，例如某个站点更换了网卡，其MAC地址就会改变。

#### 透明网桥的生成树协议STP

为了提高以太网的可靠性，有时需要在两个以太网之间使用多个透明网桥来提供冗余链路。

在增加冗余链路提高以太网可靠性的同时，却给网络引入了环路。

网络中的广播帧将在环路中永久兜圈，造成广播帧充斥整个网络，网络资源被白白浪费，而网络中的主机之间无法正常通信!



![image-20241201161048453](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(11).png?raw=true)

B2为冗余链路。

但是如果一个主机发送广播帧，则会在这个环路中兜圈。造成广播帧充斥整个网络，网络资源被白白浪费，而网络中的主机之间无法正常通信!

说明:
(1)若网桥B1和B2的转发表中都没有待转发单播帧目的MAC地址的相关记录，则该单播帧也会引起类似的情况。

(2)为了简单起见，未考虑信号在总线上碰撞的情况。



为了避免广播帧在环路中永久兜圈，透明网桥使用生成树协议(Spanning Tree Protocol，STP)，可以在增加冗余链路提高网络可靠性的同时，又避免环路带来的问题。

不管网桥之间连接成了怎样复杂的带环拓扑，网桥之间通过交互网桥协议单元(Bridge Protocol Data Unit，BPDU)，找出原网络拓扑的一个连通子集(即生成树)，在这个子集里整个连通的网络中不存在环路。

当首次连接网桥或网络拓扑发生变化时(人为改变或出现故障)，网桥都会重新构造生成树，以确
保网络的连通。

![image-20241201162305574](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(12).png?raw=true)

网桥B1和B2通过交互BPDU，找出了一个连通以太网E1和E2，并且不存在环路的生成树，而网桥B2与以太网E2连接的接口，并不在该生成树链路上，网桥B2关闭该接口，以大网E1和E2是通过网桥B1连通的，当首次连接网桥或网络拓扑发生变化时(人为改变或出现故障)，网桥都会重新构造生成树，以确保网络的连通。例如，网桥B1与以太网E1之间的链路，出现了故障，网桥B1和B2通过交互BPDU，重新构造了一个可以连通以太网E1和E2的生成树，只要只要网桥B2重新开启自己与以太网E2的连接接口即可，这样以太网E1和E2重新通过网桥B2连通。

#### 交换式以太网

网桥的接口数量很少，通常只有2~4个，一般只用来连接不同的网段。

1990年面世的交换式集线器(Switching Hub)，实质上是具有多个接口的网桥，常称为以太网交换机(Switch)或二层交换机。

- “二层”是指以太网交换机工作在数据链路层(包括物理层)。

- 与网桥相同，交换机内部的转发表也是通过自学习算法，基于网络中各主机间的通信，自动地逐步建立起来的。
- 另外，交换机也使用生成树协议STP，来产生能够连通全网但不产生环路的通信路径

仅使用交换机(而不使用集线器)的以太网就是交换式以太网，

![image-20241201162741568](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(13).png?raw=true)

![image-20241201162822552](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(14).png?raw=true)

#### 以太网交换机

以太网交换机(以下简称交换机)本质上就是一个多接口的网桥:

- 交换机自学习和转发帧的流程与网桥是相同的。
- 另外，交换机也使用生成树协议STP，来产生能够连通全网但不产生环路的通信路径

交换机的每个接口可以连接计算机，也可以连接集线器或另一个交换机。

当交换机的接口与计算机或交换机连接时，可以工作在全双工方式，并能在自身内部同时连通多对接口，使每一对相互通信的计算机都能像独占传输媒体那样，无碰撞地传输数据，这样就不需要使用CSMA/CD协议了。 

当交换机的接口连接的是集线器时，该接口就只能使用CSMA/CD协议并只能工作在半双工方式现在的交换机和计算机中的网卡都能自动识别上述两种情况，并自动切换到相应的工作方式。

交换机一般都具有多种速率的接口，例如10Mb/s、100Mb/s、1Gb/s甚至10Gb/s的接口，大部分接口支持多速率自适应。

![image-20241201165833066](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(15).png?raw=true)

![image-20241201170059442](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(16).png?raw=true)

| 主机间的通信 | 交换机1的操作  | 交换机2的操作 |
| ------------ | -------------- | ------------- |
| A-B          | 登记，盲目转发 | 登记，盲目    |
| H-A          | 登记，明确     | 登记，明确    |
| E-X          | 登记，盲目     | 登记，盲目    |
| X-E          | 登记，丢弃     | 收不到        |

A-B交换机1登记A的地址和接口1，盲目转发。盲目转发到了接口6，又到了交换机2的接口3，登记A的地址和接口3，盲目转发。

![image-20241201171210622](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(17).png?raw=true)

选B

![image-20241201171547760](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(18).png?raw=true)

PDU(Protocol Data Unit)的意思是协议数据单元，"它是计算机网络体系结构中对等实体间逻辑通信的对象。
以太网交换机工作在数据链路层(包括物理层)，它接收并转发的PDU通常称为帧。以太网交换机收到帧后，在转发表中查找帧的目的MAC地址所对应的接口号，然后通过该接口转发帧。

MAC地址又称为硬件地址或物理地址，请注意:不要被“物理”字误导认为物理地址属于物理层范畴，物理地址属于数据链路层范畴。

一般的交换机都采用“存储转发”方式，为了减小交换机的转发时延，某些交换机采用了直通(Cut-Through)交换方式。
采用直通交换方式的交换机，在接收帧的同时就立即按帧的目的MAC地址决定该帧的转发接口，然后通过其内部基于硬件的交叉矩阵进行转发，而不必把整个帧先缓存后再进行处理。
直通交换的时延非常小。
直通交换不检查差错就直接将帧转发出去，有可能会将一些无效帧转发给其他主机。

![image-20241201174924083](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(19).png?raw=true)

![image-20241201174936020](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%915%20(20).png?raw=true)

题目给定:输出端口无排队 直通交换不包括前导码
可以推出:只要接收完以太网帧的目的MAC地址就可以将帧直接转发到目的端口，而不缓存也不检验帧。引入的最小转发延迟就是接收完目的MAC地址所耗费的时间。

选C

#### 共享式以太网与交换式以太网的对比(集线器与交换机的对比）

 ![image-20241202092420133](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%916%20(1).png?raw=true)

单播帧：集线器将帧转发到整个网络中，交换机查找转发表将帧转发到B

![image-20241202092659015](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%916%20(2).png?raw=true)

广播帧：集线器将帧转发到整个网络中，交换机查找转发表将帧通过其他的所有接口转发到网络中。

区别：

集线器工作在物理层，只能接收到帧后转发到整个网络中。

交换机工作在数据链路层，可以查看帧首部的目的地址。

![image-20241202093113376](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%916%20(3).png?raw=true)

碰撞后成为碰撞帧，传到其他主机中，主机检测到是碰撞帧，将其丢弃。

交换机可以存储转发，能够实现多对接口的高速并行交换，因此可以同时转发多个帧。

###### 用集线器和交换机连接两个广播域

![image-20241202093552812](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%916%20(4).png?raw=true)

![image-20241202093539876](https://github.com/xiaoyizhiy/testnotebook/blob/main/%E8%AE%A1%E7%BD%916%20(5).png?raw=true)

![image-20241202093700832](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202093700832.png)

A

网桥(bridge)工作在数据链路层(包含其下的物理层)，因此网桥具备属于数据链路层范畴的相关能力。
网桥的接口数量很少，通常只有2~4个，一般只用来连接不同的网段。
1990年面世的交换式集线器(SwitchingHub)实质上是具有多个接口的网桥，常称为以太网交换机(Switch)或二层交换机。

以太网交换机工作在数据链路层(包含其下的物理层)，因此以太网交换机具备属于数据链路层范畴的相关能力。但不同网络层协议的网络互联属于网络层范畴，以太网交换机无法处理。

![image-20241202094643566](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202094643566.png)

![image-20241202095001117](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202095001117.png)

D

默认交换机没有自学习完成。 

被交换机登记并盲目转发，由于目的地址不同，1、3丢弃。确认帧3收到，交换机中又了2的端口号，所以转发给了2

![image-20241202095630838](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202095630838.png)

C

![image-20241202100012150](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202100012150.png)

#### 以太网的MAC帧格式

![image-20241202100413696](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202100413696.png)

![image-20241202100459171](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202100459171.png)

类型：其值用来指明数据载荷中的内容是由上一层的哪个协议封装的以便将收到的MAC帧的数据载荷上交给上一层的这个协议。

FCS：使用CRC生成的帧检验序列FCS，接收方的网卡通过FCS的内容就可检测出帧在传输过程中是否产生了误码。检测范围为目的地址到数据载荷。

数据载荷长度不宜过多和过少：

帧的长度最小为64B，除了目的地址和源地址、类型和FCS外，数据载荷最小为46B，若不够46B，数据链路层会在后面添加填充字节。（以太网用的csma/cd协议，如果帧太短，发送时延小于争用期，就检测不到碰撞了，边传输边监听，小于64B会导致发送完毕后停止监听，可能碰撞而不自知）

又由于数据载荷的长度相较于帧首部和尾部的长度要尽量大，但是由于FCS要差错检测，也不能太长因此 数据载荷的最大长度被限制为1500字节。
数据链路层将封装好的帧交给物理层，该层还要在其前面添加8字节的前导码

![image-20241202102324660](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202102324660.png)

同步码使接收方的时钟同步。（由于数据传输是以时钟为基准的，如果没有时钟同步，接收方可能会误认为某些数据位开始的时刻比实际的时刻要晚或者早，从而导致解码错误。）

接收方可能收到的无效MAC帧包括以下几种:
MAC帧的长度不是整数个字节
通过MAC帧的FCS字段的值检测出帧有误码
MAC帧的长度不在64~1518字节之间

接收方收到无效的MAC帧时，i就简单将其丢弃，以太网的数据链路层没有重传机制。（因为以太网是有线局域网，链路层不支持可靠传输，但无线局域网就支持。）

#### 虚拟局域网VLAN的

将多个站点通过一个或多个以太网交换机连接起来就构建出了交换式以太网。

交换式以太网中的所有站点都属于同一个广播域。

随着交换式以太网规模的扩大，广播域也相应扩大。

巨大的广播域会带来一系列问题：

广播风暴（广播风暴会浪费网络资源和各主机的CPU资源）
难以管理和维护，带来潜在的安全问题。

TCP/IP协议栈中的很多协议都会使用广播:

- 地址解析协议ARP（在以太网和其他数据链路层网络中，通信设备使用MAC地址来标识设备。当一个设备想要发送数据包到另一台设备时，它必须知道目标设备的MAC地址。但发送方通常只知道目标设备的IP地址，因此需要使用ARP来解析IP地址到MAC地址。当设备A想要与设备B通信时，它首先需要获取设备B的MAC地址。设备A将发出一个ARP请求包，这个包是一个广播包，内容包括设备A的IP和MAC地址，以及设备B的IP地址。由于这是广播包，网络上的所有设备都能收到这个请求。会造成广播风暴。）
- 路由信息协议RIPv1
- 动态主机配置协议DHCP

NetBEUl:Windows下使用的广播型协议

IPX/SPX:Novell网络的协议栈

Apple Talk:Apple公司的网络协议栈

分割广播域的方法：

- 使用路由器可以隔离广播域(成本较高)

![image-20241202151339828](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202151339828.png)

- 虚拟局域网技术应运而生

#### 虚拟局域网VLAN概述

虚拟局域网(Virtual Local Area Network，VLAN)是一种将局域网内的站点划分成与物理位置无关的逻辑组的技术，一个逻辑组就是一个VLAN，VLAN中的各站点具有某些共同的应用需求。

![image-20241202152610045](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202152610045.png)

交换机连接三个网段，同时也可以将不同网段中的主机划分到同一VLAN中。

属于同一VLAN的站点之间可以直接进行通信，而不同VLAN中的站点之间不能直接通信。
网络管理员可对局域网中的各交换机进行配置来建立多个逻辑上独立的VLAN。
连接在同一交换机上的多个站点可以属于不同的VLAN，而属于同一VLAN的多个站点可以连接在不同的交换机上。

虚拟局域网VLAN并不是一种新型网络，它只是局域网能够提供给用户的一种服务。

#### 虚拟局域网VLAN的实现机制

虚拟局域网VLAN有多种实现技术，最常见的就是基于以太网交换机的接口来实现VLAN。这就需要以太网交换机能够实现以下两个功能:

- 能够处理带有VLAN标记的帧，也就是IEEE 802.1Q帧。
- 交换机的各接口可以支持不同的接口类型，不同接口类型的接口对帧的处理方式有所不同。

###### IEEE 802.1Q帧

IEEE 802.1Q帧也称为Dot One Q帧，它对以太网V2的MAC帧格式进行了扩展:在源地址字段和类型字段之间插入了4字节的VLAN标签(tag)字段。

![image-20241202153350252](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202153350252.png)

![image-20241202153427353](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202153427353.png)

VLAN标签字段由标签协议标识符TPID、优先级PRI、规范格式指示符CFl、虚拟局域网标识符VID四部分构成

标签协议标识符TPID:长度为16比特，其值固定为0x8100，表示该帧是IEEE802.1Q帧。

优先级PRI:长度为3比特，取值范围是0~7，值越大优先级越高。当网络阻塞时，设备优先发送优先级高的802.1Q帧。

规范格式指示符CF1:长度为1比特，取值为0表示MAC地址以规范格式封装，取值为1表示MAC地址以非规范格式封装。对于以太网，CFI的取值为0。

虚拟局域网标识符VID:长度为12比特，取值范围是0~4095，其中0和4095保留不使用。VID是802.1Q帧所属VLAN的编号，设备利用VID来识别帧所属的VLAN。广播帧只在同一VLAN内转发，这样就将广播域限制在了一个VLAN内。

802.1Q帧一般不由用户主机处理，而是由以太网交换机来处理:

- 当交换机收到普通的以太网MAC帧时，会给其插入4字节的VLAN标签使之成为802.1Q帧，该处理简称为“打标签”。
- 当交换机转发802.1Q帧时，可能会删除其4字节的VLAN标签使之成为普通的以太网MAC帧，该处理简称为“去标签”。交换机转发802.1Q帧时也有可能不进行“去标签”处理，是否进行“去标签”处理取决于交换机的接口类型。

###### 虚拟局域网VLAN的实现机制——以太网交换机的接口类型

根据接口在接收帧和发送帧时对帧的处理方式的不同，以及接口连接对象的不同，以太网交换机的接口类型一般分为Access和Trunk两种。

当以太网交换机上电启动后，若之前未对其各接口进行过VLAN的相关设置，则各接口的接口类型默认为Access，并且各接口的缺省VLAN ID为1，即各接口默认属于VLAN1。

- 对于思科交换机，接口的缺省VLANID称为本征VLAN(Native VLAN)。
- 对于华为交换机，接口的缺省VLANID称为端口VLAN ID(Port VLAN ID)，简记为PVID。

交换机的每个接口有且仅有一个PVID

【例1】在一个交换机上不进行人为的VLAN划分，交换机各接口默认属于VLAN1且类型为Access的情况。

![image-20241202160006153](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202160006153.png)

【例2】在一个交换机上划分两个不同VLAN的情况。（思科模拟器学习）

![image-20241202160312476](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202160312476.png)

打标签的VID为2，接口2的PVID值也为2，所以在接口2转发。

![image-20241202160426048](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202160426048.png)

【例3】两个交换机通过Trunk类型的接口互连，Trunk接口将802.1Q帧“去标签”后进行转发的情况。

![image-20241202160717111](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202160717111.png)

【例4】两个交换机通过Trunk类型的接口互连，Trunk接口将802.1Q帧直接转发的情况

![image-20241202161048282](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202161048282.png)

| Access接口                                                   | Trunk接口                                                    |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| Access接口一般用于连接用户计算机，由于其只能属于一个VLAN，因此Access接口的PVID值与其所属VLAN的ID相同，其默认值为1。<br/>接收处理：<br/>一般只接受“未打标签”的普通以太网MAC帧，根据接收帧的接口的PVID给帧“打标签”，即插入4字节的VLAN标签字段，VLAN标签字段中的VID取值就是接口的PVID值。<br/>转发处理：<br/>若帧中的VID值与接口的PVID值相等，则给帧“去标签”后再进行转发，否则不转发帧。因此从Access接口转发出的帧，是不带VLAN标签的普通以太网MAC帧。 | Trunk接口一般用于交换机之间的互连。Trunk接口可以属于多个VLAN，即Trunk接口可以通过属于不同VLAN的帧。Trunk接口的默认PVID值为1，一般不建议用户修改，若互连的Trunk接口的PVID值不相等，则可能出现转发错误。<br/>接收处理：既可以接收“未打标签”自的普通以太网MAC帧也可以接收“已打标签”的802.1Q帧。若接收到普通以太网MAC帧时，根据接收帧的接口的PVID给帧“打标签”，这与Access接口的处理相同。<br/>转发处理：对于帧的VID值等于接口的PVID值的802.1Q帧，将其“去标签”转发;对于帧的VID值不等于接口的PVID值的802.1Q帧，将其直接转发。因此，从Trunk接口转发出的帧，可能是普通以太网MAC帧也可能是802.1Q帧。 |

| Hybrid接口                                                   | 1    |
| ------------------------------------------------------------ | ---- |
| Hybrid接口是华为交换机私有的接口类型。Hybrid接口既可以用于交换机之间的互连(与Trunk接口相同)，也可用于交换机与用户计算机之间的互连(与Access接口相同)。<br/>除此之外，Hybrid接口的绝大部分功能与Trunk接口相同。不同点在于Hybrid接口的转发处理:Hybrid接口会查看帧的VID值是否在接口的“去标签"列表中，若存在则“去标签”后转发，若不存在则直接转发。 |      |

![image-20241202163416470](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202163416470.png)



#### 以太网的发展

###### 100BASE-T以太网

100BASE-T以太网是指在双绞线上传输基带信号的速率为100Mbs的以太网，也称为快速以太网(Fast Ethermet)

100BASE-T以太网与10Mbs标准以太网(传统以太网)一样，仍然使用IEEE802.3的帧格式和CSMA/CD协议.。

100BASE-T以太网为了与10Mb/s标准以太网保持兼容，需要以太网最小帧长保持不变，即仍为64字节。

网段的最大电缆长度从1000m减小到100m
争用期缩短为5.12us
帧间最小间隔缩短为0.96us

100BASE-T以太网还可以使用以太网交换机来提供比集线器更好的服务质量，即在全双工方式下无碰撞工作。因此，使用交换机的100BASE-T以太网，工作在全双工方式下，并不使用CSMA/CD协议。

1995年，IEEE的802委员会正式批准100BASE-T以太网的标准为802.3u。实际上，IEEE802.3u只是对原有IEEE802.3标准的补充。
除100BASE-T以太网外，百兆以太网有多种不同的物理层标准:

![image-20241202164301300](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202164301300.png)

###### 吉比特以太网

吉比特以太网也称为干兆以太网(Gigabit Ethernet)。1998年，干兆以太网的标准802.3z成为正式标准近几年来，干兆以太网已迅速占领市场，成为了以太网的主流产品。

IEEE 802.3z干兆以太网的主要特点有:
速率为1000Mb/s(1Gb/s)
使用IEEE 802.3的帧格式(与10Mb/s和100Mb/s以太网相同)支持半双工方式(使用CSMA/CD协议)和全双工方式(不使用CSMAICD协议)

兼容10BASE-T和100BASE-T技术

当干兆以太网工作在半双工方式时，需要使用CSMAICD协议。由于速率已经提高到了1000Mb/s，因此只有减小网段最大长度或增大最小帧长，才能使3.4.2节中介绍的以太网的参数a(τ/T)保持为较小的数值。（信道利用率）

若将网段最大长度减小到10m，则网络基本失去了应用价值，若将最小帧长增大到640字节，则当上层交付的待封装的协议数据单元PDU很短时，开销就会太大。
干兆以太网的网段最大长度仍保持为100m，最小帧长仍保持为64字节(与10BASE-T和100BASE-T兼容)

这就需要使用载波延伸(Carier Extension)的办法，将争用期增大为512字节的发送时间而保持最小帧长仍为64字节。
只要发送的MAC帧的长度不足512字节时，就在MAC帧尾部填充一些特殊字符，使MAC帧的长度增大到512字节。

![image-20241202165139406](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202165139406.png)

在使用载波延伸的机制下，如果原本发送的是大量的64字节长的短帧，则每一个短帧都会被填充448字节的特殊字符，这样会造成很大的开销。

因此，干兆以太网还使用了分组突发(Packet Bursting)功能。也就是当有很多短帧要连续发送时，只将第个短帧用载波延伸的方法进行填充，而其后面的一系列短帧不用填充就可一个接一个地发送，它们之间只需空开必要的帧间最小间隔即可。

这样就形成了一连串分组的突发，当累积发送1500字节或稍多一些为止。

![image-20241202165243896](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202165243896.png)

![image-20241202165258599](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202165258599.png)

###### 10吉比特以太网

2002年6月，IEEE802.3ae委员会通过10吉比特以太网(10GE)的正式标准，10GE也称为万兆以太网。

万兆以太网并不是将干兆以太网的速率简单地提高了10倍。万兆以太网的目标是将以太网从局域网范围(校园网或企业网)扩展到城域网与广域网，成为城域网和广域网的主干网的主流技术之一。IEEE 802.3ae万兆以太网的主要特点有:
速率为10Gb/s
使用IEEE 802.3标准的帧格式(与10Mb/s、100Mb/s和1Gb/s以太网相同)

保留IEEE 802.3标准对以太网最小帧长和最大帧长的规定。这是为了用户升级以太网时，仍能和较低速率的以太网方便地通信。

只工作在全双工方式而不存在争用媒体的问题，因此不需要使用CSMAICD协议，这样传输距离就不再受碰撞检测的限制。

增加了支持城域网和广域网的物理层标准。

万兆以太网交换机常作为干兆以太网的汇聚层交换机，与干兆以太网交换机相连，还可以连接对传输速率要求极高的视频服务器、文件服务器等设备。

![image-20241202170000886](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202170000886.png)

###### 40/100吉比特以太网

2010年，IEEE发布了40吉比特1100吉比特以太网(40GE100GE)的IEEE802.3ba标准，40GE/100GE也称为四万兆十万兆以太网。
为了使以太网能够更高效、更经济地满足局域网、城域网和广域网的不同应用需求，IEEE 802.3ba标准定义了两种速率类型:

40Gb/s主要用于计算应用
100Gb/s主要用于汇聚应用

IEEE 802.3ba标准只工作在全双工方式(不使用CSMA/CD协议)，但仍使用IEEE 802.3标准的帧格式并遵守最小帧长和最大帧长的规定。

![image-20241202170123633](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202170123633.png)

![image-20241202170227363](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202170227363.png)

#### 无线局域网的组成

随着移动通信技术的发展，无线局域网(Wireless Local Area Network，WLAN)自20世纪80年代末以来逐步进入市场。
IEEE于1997年制定出了无线局域网的协议标准802.11，802.11无线局域网是目前应用最广泛的无线局域网之一，人们更多地将其简称为Wi-Fi(Wireless Fidelity，无线保真度)。

802.11无线局域网可分为以下两类:
有固定基础设施的
无固定基础设施的
固定基础设施是指预先建立的、能够覆盖一定地理范围的、多个固定的通信基站

802.11无线局域网使用最多的是它的固定基础设施的组网方式。

![image-20241202171143257](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202171143257.png)

本BSS内各站点之间的通信以及与本BSS外的站点之间的通信，都必须经过本BSS内的AP进行转发。

网络管理员需要为AP分配一个最大32字节的服务集标识符(Service SetIdentifier，SSlD)和一个无线通信信道，SSID实际上就是使用该AP的802.11无线局域网的名字。（可以把AP当作路由器，把SSID当WIFI的名字）

一个BSS可以是孤立的，也可以通过一个分配系统DS与其他BSS连接，成为扩展服务集ESS。

![image-20241202171254290](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202171254290.png)

802.11标准并没有定义实现漫游的具体方法，仅定义了以下一些基本服务。

① 关联(Association)服务

移动站与接入点AP建立关联的方法有以下两种:

- 被动扫描

- 主动扫描

  ②重建关联(Reassociation)服务和分离(Dissociation)服务

  如果一个移动站要把与某个接入点AP的关联转移到另一个AP，就可以使用重建关联服务；若要终止关联服务，就应使用分离服务。

![image-20241202171806900](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202171806900.png)自组织网络组网方便，不需要基站，并且具有非常好的生存性，这使得自组织网络在军用和民用领域都有很好的应用前景。

802.11无线局域网的ad hoc模式允许网络中的各站点在其通信范围内直接通信，也就是支持站点间的单跳通信，而标准中并没有包括多跳路由功能。因此，802.11无线局域网的ad hoc模式应用较少。

#### 802.11无线局域网的物理层

802.11无线局域网的物理层非常复杂，依据工作频段、调制方式、传输速率等，可将其分为多种物理层标准。

![image-20241202172041093](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241202172041093.png)

802.11无线网卡一般会被做成多模的，以便能适应多种不同的物理层标准，例如支持802.11b/g/n。

无线局域网最初还使用红外技术(infrared，IR)和跳频扩频(Frequency Hopping  Spread Spectrum，FHSS）技术，但目前已经很少使用了。
跳频技术的发明人，是好莱坞黄金时代的著名女星海蒂·拉玛，跳频技术为CDMA和Wi-Fi等无线通信技术奠定了基础。因此，海蒂·拉玛被誉为“'Wi-Fi之母”。

最近几年，802.11无线局域网又有一些新的物理层标准陆续推出:

2012
802.11ad
频段:60GHz 最高速率:7Gb/s 家庭内部无线高清 音视频信号传输

2013
802.11ac
频段:5GHz 最高速率:1Gb/s

2016
802.11ah
频段:900MHz 最高速率:18Mb/s 功耗低、传输距离长(可达1km)，很适合物联网设备之间的通信

2019
802.11ax
频段:2.4GHz/5GHZ 最高速率:9.6Gb/s

#### 802.11无线局域网使用CSMA/CA协议的原因

![image-20241203091945810](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203091945810.png)

![image-20241203092004481](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203092004481.png)

同样使用广播信道的无线局域网能不能也使用CSMAICD协议呢?

对于802.11无线局域网，其使用无线信道传输数据，这与共享总线以太网使用有线传输介质不同。因此802.11无线局域网不能简单照搬共享总线以太网使用的CSMAICD协议。
802.11无线局域网采用了另一种称为CSMA/CA的协议，也就是载波监听多址接入/碰撞避免(Carrier Sense Multiple Access/Collision Avoidance,CSMA/CA)。
CSMAV/CA协议仍然采用CSMA/CD协议中的CSMA，以“先听后说”的方式来减少碰撞的发生，但是将“碰撞检测CD”改为了“碰撞避免CA”。（尽管CA表示碰撞避免，但并不能避免所有的碰撞，而是尽量减少碰撞发生的概率。）

802.11无线局域网不采用“碰撞检测CD”的原因如下:
由于无线信道的传输环境复杂且信号强度的动态范围非常大，在802.11无线网卡上接收到的信号强度-般都远远小于发送信号的强度，信号强度甚至相差百万倍。因此，如果要在802.11无线网卡上实现碰撞检测，对硬件的要求非常高。

即使能够在硬件上实现碰撞检测功能，但由于无线电波传播的特殊性(存在隐蔽站问题)，还会处出现无法检测到碰撞的情况，因此实现碰撞检测并没有意义。

###### 无线局域网的隐蔽站问题(Hidden Station Problem)

![image-20241203093238286](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203093238286.png)

A、B的信号覆盖范围均不包括对方，所以发送的信号均不能被对方收到，但是它两的信号能够到达路由器处（AP），会产生碰撞，碰撞信号传到A和B时，由于信号非常弱，检测不到，所以A和B互为隐蔽站。

无线局域网不能简单照搬共享总线以太网(有线局域网)使用的CSMA/CD协议，而是不再实现碰撞检测CD功能，但在CSMA的基础上增加碰撞避免CA功能，即使用CSMA/CA协议。

##### CSMA/CA协议的基本工作原理

信道空闲时，要等待DCF间隔后才能发，原因是要等待一会，若没有优先级更高的帧发送，才能发送这个帧。

（DCF帧间间隔DIFS的长度为128微秒，在DCF方式中，DIFS用来发送数据帧和管理帧。DCF是分布式协调功能(Distributed Coordination Function，DCF)的英文缩写词。在DCF方式下没有中心控制站点，每个站点使用CSMA/CA协议通过争用信道来获取发送权。DCF方式是802.11定义的默认方式(必须实现)）

帧首部中的“持续时间”字段的值指出了源站要占用信道的时间(包括目的站发回确认帧所需的时间)

当某个站检测到正在信道中传送的帧首部中的“持续时间”字段时，就调整自己的网络分配向量(Network Allocation Vector，NAV)。 NAV指出了完成这次帧的传送且信道转入空闲状态所需的时间。（虚拟载波监听(Virtual Carrier Sense)机制  ）

短帧间间隔(Short Interframe Space，SIFS)的长度为28us，它是最短的帧间间隔，用来分隔开属于一次对话的各帧。一个站点应当能够在这段时间内从发送方式切换到接收方式。使用SIFS的帧类型有ACK帧、CTS帧等。

由于无线信道的误码率较高，CSMA/CA协议还需要使用停止-等待的确认机制来实现可靠传输，这与使用CSMA/CD协议的共享式以太网不同。

![image-20241203095230106](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203095230106.png)

D

随机退避时间：当某个站在发送帧时，很可能有多个站都在监听信道并等待发送帧一旦信道空闲，这些站几乎同时发送帧而产生碰撞。为了避免上述情况，所有要发送帧的站检测到信道从忙转为空闲后都要执行退避算法。这样不仅可以减少发生碰撞的概率，还可避免某个站长时间占用无线信道。

当某个站要发送数据帧时，仅在这种情况下才不使用退避算法:检测到信道空闲，并且该数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧。

除此之外的以下情况，都必须使用退避算法:

- 在发送帧之前 检测到信道处于忙态
- 在每一次重传一个帧时
- 在每一次成功发送帧后要连续发送下一个帧时

###### CSMA/CA协议的退避算法

在执行退避算法时，站点为退避计时器设置的一个随机的退避时间:

- 当退避计时器的时间减小到零时，就开始发送数据;

- 当退避计时器的时间还未减小到零时而信道又转变为忙状态，这时就冻结退避计时器的数值，重新等待信道变为空闲，再经过帧间间隔DIFS后，继续启动退避计时器。

在进行第i次退避时，退避时间在时隙编号{0，1……，2^(2+i)-1}中随机选择一个，然后乘以基本退避时间(也就是一个时隙的长度)就可以得到随机的退避时间。当时隙编号达到255时(对应于第6次退避)就不再增加了。

![image-20241203145719160](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203145719160.png)

A占用信道发送帧，此时BCD也要发送，于是它们进行载波检测，发现信道忙，需要退避，根据退避算法，选择出各自的随机退避时间，并在每个时隙对信道进行一次检测，当检测到信道由忙状态转为空闲状态，且经过帧间间隔DIFS后，退避计时器开始倒计时。

当C的退避计时器到时后，立即开始发送帧，此时信道由空闲状态转换为忙状态，当B和D检测到信道忙后，就冻结自己剩下的退避时间，假设在C占用无线信道发送帧的过程中，E也要发送帧，E于是进行载波监听，发现信道忙，需要退避，根据退避算法，选择出各自的随机退避时间，并在每个时隙对信道进行一次检测，当检测到信道由忙状态转为空闲状态，且经过帧间间隔DIFS后，退避计时器开始倒计时。

当B和D检测到信道由忙状态转为空闲状态，且经过帧间间隔DIFS后，他们的退避计时器重新开始从上次冻结的地方倒计时。D的退避计时器首先到时，立即开始发送帧，此时信道由空闲状态转为忙状态， 当B和E检测到信道忙后，就冻结自己剩下的退避时间。

当D发送完帧后，信道由忙状态转为空闲状态，当B和D检测到信道由忙状态转为空闲状态，且经过帧间间隔DIFS后，他们的退避计时器重新开始从上次冻结的地方倒计时。

E的退避计时器首先到时，E立即开始发送帧，此时信道由空闲状态转为忙状态，当B检测到信道忙后，就冻结自己剩下的退避时间。当E发送完后，道由忙状态转为空闲状态。当B检测到信道由忙状态转为空闲状态，且经过帧间间隔DIFS后，他们的退避计时器重新开始从上次冻结的地方倒计时。当B的退避计时器到时后，B立即开始发送帧。若B还有帧要发送时，要先经过帧间间隔DIFS后，再退避一段随机时间后才能发送。



为了进一步降低发生碰撞的概率，802.11无线局域网允许源站对信道进行预约。

RTS(Request To Send)帧是短的控制帧，它包括源地址、目的地址和本次通信(包括目的站发回确认帧所需的时间)所需的持续时间。

CTS(Clear To Send)帧是短的响应控制帧，它也包括本次通信所需的持续时间(从RTS帧中将此持续时间复制到CTS帧中)

除源站和目的站的其他各站，在收到CTS帧或数据帧后就推迟访问信道。这样就确保了源站和目的站之间的通信不会受到其他站的干扰。

若RTS帧发生碰撞，源站就不可能收到CTS帧，源站会执行退避算法重传RTS帧。

使用RTS帧和CTS帧进行信道预约会带来额外的开销但由于RTS帧和CTS帧都很短，发生碰撞的概率、碰撞产生的开销以及本身的开销都很小。对于一般的数据帧其发送时延往往远大于传播时延(因为是局域网)，碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，因此用很小的代价对信道进行预约往往是值得的。

尽管如此，802.11无线局域网仍为用户提供了以下三种选择:

- 使用RTS帧和CTS帧
- 只有当数据帧的长度超过某个数值时才使用RTS帧和CTS帧
- 不使用RTS帧和CTS帧

由于RTS帧和CTS帧都会携带通信需要持续的时间，这与之前介绍过的数据帧可以携带通信所需持续时间的虚拟载波监听机制是一样的，因此使用RTS帧和CTS帧进行信道预约，也属于虚拟载波监听机制。

利用虚拟载波监听机制，站点只要监听到数据帧、RTS帧或CTS帧中的任何一个，就能知道信道将被占用的持续时间，而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题。

![image-20241203150310516](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203150310516.png)

 如图所示，A和B互为隐蔽站，A给AP发送RTS帧进行信道预约，虽然B监听不到该帧，但是可以监听到AP应答给A的CTS帧，B根据CTS帧中的时间修改自己的网络分配向量NAV，在NAV指示的时间内，虽然B监听不到A发送给AP的帧，但是B也不会发送帧干扰A和AP的通信。

![image-20241203150922165](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203150922165.png)

![image-20241203151124676](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203151124676.png)

D

![image-20241203151220538](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203151220538.png)

A

![image-20241203151531684](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203151531684.png)

![image-20241203151543967](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203151543967.png)

#### 802.11无线局域网的MAC帧

| 数据帧               | 控制帧                                                       | 管理帧                                                       |
| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 用于在站点间传输数据 | 通常与数据帧搭配使用<br/>负责区域的清空、虚拟载波监听的维护以及信道的接入，并于收到数据帧时予以确认。<br/>ACK帧、RTS帧以及CTS帧等都属于控制帧。 | 用于加入或退出无线网络以及处理AP之间连接的转移事宜。<br/>信标帧、关联请求帧以及身份认证帧等都属于管理帧。 |



去往DS控制位、来自DS控制位：他们用于地址1~地址4这四个字段的内容和使用情况

DS是分配系统的英文缩写词

类型和子类型控制位：用于区分不同类型的帧（数据帧  控制帧  管理帧）

有线等效保密WEP控制位：用于指示是否使用了WEP加密算法。WEP表明使用在无线信道上的这种加密算法，在效果上可以和在有线信道上进行通信一言保密。

帧头中的持续期字段：在数据帧、RTS帧和用于实现CSMA/CA的虚拟载波监听和信道预约机制。CTS帧中用该字段指出将要持续占用信道的时长

帧头中的序号控制字段：用来实现802.11的可靠传输，对数据帧进行编号。

帧头中的地址1到4：取决于帧控制字段中的“去往DS”(到分配系统)和'来自DS”(分配系统)这两个字段的值。

有三个地址，分别是A的地址，AP地址，目的主机地址B，地址1和2分别是传输时的目的地址和源地址，剩下的地址放到地址3就行了

![image-20241203154034561](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203154034561.png)

![image-20241203154218645](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203154218645.png)

A要向B发送数据帧

你我他

A向R发送数据帧

DS时以太网，所以AP1会将A发送的802.11帧转换为MAC帧

![image-20241203155118803](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203155118803.png)

R发送响应帧

![image-20241203155405773](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203155405773.png)

802.11帧中要携带AP的MAC地址，而以太网帧中却不需要携带AP的MAC地址。

![image-20241203155816830](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20241203155816830.png)
